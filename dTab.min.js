/* ========================================================================
 * dTab: DynamicTab的简写
 * 基于bootstrap的 tab.js，扩展了动态添加tab的功能
 * by soon 
 * https://github.com/soonyh
 * ========================================================================*/
+function(a){function c(b,c){this.options=c,this.$element=a(b),this.$container=a(this.options.container),this.$container.addClass(this.options.theme),this.nickname=d("adder"),this.init(),this.isInsert=!1}function d(a){return a+"_"+Math.floor(Math.random()*(new Date).getTime())}var b,e;c.DEFAULTS={container:"",empty:"no data",limit:!1,source:"",title:"New",removeable:!1,theme:"dTab-primary"},c.prototype.init=function(){},c.prototype.add=function(){var b,c,e,h,f=d("tab"),i="",j='<ul class="nav nav-tabs dTab-nav"> </ul> <div class="tab-content"> </div>';this.$element.attr("id",this.nickname),0==this.$container.children(".nav").size()&&this.$container.html(j),this.$nav=this.$container.children(".nav"),this.$tabContent=this.$container.children(".tab-content"),b=a("<a>").attr({"data-toggle":"tab",href:"#"+f}).html('<span class="sl80">'+this.options.title+"</span>"),this.options.removeable&&(this.options,h=a("<span>").addClass("dTab-close").attr({"data-dismiss":"dTab","data-add-by":this.nickname}),b.append(h)),this.$nav.children("li").removeClass("active"),c=a("<li>").append(b).addClass("active").appendTo(this.$nav),this.$tabContent.children("div").removeClass("active"),e=a("<div>").attr("id",f).addClass("tab-pane active"),this.$tabContent.append(e),/#/.test(this.options.source)?i=a(this.options.source).html():(e.append('<img src="img/spinner.gif" widht="16" height="16" class="dTab-loading">'),a.ajax({url:this.options.source,type:"get",async:!1,dataType:"html"}).done(function(a){i=a})),this.$tabContent.append(e.html(i)),this.isInsert=!0,this.options.limit&&this.$element.addClass("dTab-disabled").attr("title","only add one time")},c.prototype.remove=function(b){var i,j,c=a(b),d=a("#"+c.data("add-by")),e=c.closest("li"),f=e.prev(),g=e.next(),h=e.closest(".nav"),k=h.children("li").index(e);return e.remove(),this.$container.find(".tab-content").children(".tab-pane").eq(k).remove(),this.options.limit&&(d.removeClass("dTab-disabled").removeAttr("title"),this.isInsert=!1),0==f.size()&&0==g.size()?(this.$container.html("<p>no data</p>"),void 0):(h.children("li").removeClass("active"),this.$container.children("div").removeClass("active"),f.size()>0?(f.addClass("active"),i=h.children("li").index(f),this.$container.find(".tab-content").children(".tab-pane").eq(i).addClass("active"),void 0):g.size()>0?(g.addClass("active"),j=h.children("li").index(g),this.$container.find(".tab-content").children(".tab-pane").eq(j).addClass("active"),void 0):void 0)},e=a.fn.dTab,a.fn.dTab=function(d){return this.each(function(){var f,e=a(this);b=e.data("bs.dTab"),f=a.extend({},c.DEFAULTS,"object"==typeof d&&d),b||e.data("bs.dTab",b=new c(this,f)),"string"==typeof d&&b[d](),(1!=f.limit||1!=b.isInsert)&&b.add()})},a.fn.dTab.Constructor=c,a.fn.dTab.noConflict=function(){return a.fn.dTab=e,this},a(document).on("click.bs.dTab.data-api","[data-toggle=dTab]",function(b){var d,c=a(this);c.is("a")&&b.preventDefault(),d=c.data(),c.dTab(d)}),a(document).on("click.bs.dTab.data-api","[data-dismiss=dTab]",function(){b.remove(this)})}(jQuery);
