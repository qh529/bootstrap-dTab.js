/* ========================================================================
 * dTab: DynamicTab的简写
 * 基于bootstrap的 tab.js，扩展了动态添加tab的功能 *
 * by soon 
 * https://github.com/soonyh
 * ========================================================================
+function($){var instance;function DTab(element,options){this.options=options;this.$element=$(element);this.$container=$(this.options.container);this.$container.addClass(this.options.theme);this.nickname=_getUniqueID("adder");this.init();this.isInsert=false}function _getUniqueID(prefix){return prefix+"_"+Math.floor(Math.random()*(new Date()).getTime())}DTab.DEFAULTS={"container":"","empty":"no data","limit":false,"source":"","title":"New","removeable":false,"theme":"dTab-primary"};DTab.prototype.init=function(){};DTab.prototype.add=function(){var $a,$li,$div,id=_getUniqueID("tab"),data={},$removeBtn,html="",markup='<ul class="nav nav-tabs dTab-nav"> </ul> <div class="tab-content"> </div>';this.$element.attr("id",this.nickname);if(this.$container.children(".nav").size()==0){this.$container.html(markup)}this.$nav=this.$container.children(".nav");this.$tabContent=this.$container.children(".tab-content");$a=$("<a>").attr({"data-toggle":"tab","href":"#"+id}).html('<span class="sl80">'+this.options.title+"</span>");if(this.options.removeable){var options=this.options;$removeBtn=$("<span>").addClass("dTab-close").attr({"data-dismiss":"dTab","data-add-by":this.nickname});$a.append($removeBtn)}this.$nav.children("li").removeClass("active");$li=$("<li>").append($a).addClass("active").appendTo(this.$nav);this.$tabContent.children("div").removeClass("active");$div=$("<div>").attr("id",id).addClass("tab-pane active");this.$tabContent.append($div);if(!/#/.test(this.options.source)){$div.append('<img src="img/spinner.gif" widht="16" height="16" class="dTab-loading">');$.ajax({url:this.options.source,type:"get",async:false,dataType:"html",}).done(function(data){html=data})}else{html=$(this.options.source).html()}this.$tabContent.append($div.html(html));this.isInsert=true;if(this.options.limit){this.$element.addClass("dTab-disabled").attr("title","only add one time")}};DTab.prototype.remove=function(el){var $dismiss=$(el),$father=$("#"+$dismiss.data("add-by")),$li=$dismiss.closest("li"),$prevLi=$li.prev(),$nextLi=$li.next(),$nav=$li.closest(".nav"),prevIndex,nextIndex,currIndex=$nav.children("li").index($li);$li.remove();this.$container.find(".tab-content").children(".tab-pane").eq(currIndex).remove();if(this.options.limit){$father.removeClass("dTab-disabled").removeAttr("title");this.isInsert=false}if($prevLi.size()==0&&$nextLi.size()==0){this.$container.html("<p>no data</p>");return}$nav.children("li").removeClass("active");this.$container.children("div").removeClass("active");if($prevLi.size()>0){$prevLi.addClass("active");prevIndex=$nav.children("li").index($prevLi);this.$container.find(".tab-content").children(".tab-pane").eq(prevIndex).addClass("active");return}if($nextLi.size()>0){$nextLi.addClass("active");nextIndex=$nav.children("li").index($nextLi);this.$container.find(".tab-content").children(".tab-pane").eq(nextIndex).addClass("active");return}};var old=$.fn.dTab;$.fn.dTab=function(option){return this.each(function(){var $this=$(this);instance=$this.data("bs.dTab");var options=$.extend({},DTab.DEFAULTS,typeof option=="object"&&option);if(!instance){$this.data("bs.dTab",(instance=new DTab(this,options)))}if(typeof option=="string"){instance[option]()}if(options.limit==true&&instance.isInsert==true){return}instance.add()})};$.fn.dTab.Constructor=DTab;$.fn.dTab.noConflict=function(){$.fn.dTab=old;return this};$(document).on("click.bs.dTab.data-api","[data-toggle=dTab]",function(e){var $adder=$(this);if($adder.is("a")){e.preventDefault()}var data=$adder.data();$adder.dTab(data)});$(document).on("click.bs.dTab.data-api","[data-dismiss=dTab]",function(e){instance.remove(this)})}(jQuery);